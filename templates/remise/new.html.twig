{% extends 'base.html.twig' %}

{% block title %}Nouvelle Remise{% endblock %}

{% block body %}
<div class="container mt-4">
    <h1>Créer une nouvelle remise</h1>
    
    {% for message in app.flashes('error') %}
        <div class="alert alert-danger">{{ message }}</div>
    {% endfor %}

    <form method="post">
        <div class="card shadow-sm mt-4">
            <div class="card-header bg-light">
                <h5 class="mb-0">Transactions disponibles</h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead>
                            <tr>
                                <th style="width: 50px;" class="text-center">
                                    <input type="checkbox" id="select-all" onclick="toggleAll(this)">
                                </th>
                                <th>Date</th>
                                <th>Libellé</th>
                                <th class="text-end">Montant</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for transaction in transactions %}
                                <tr>
                                    <td class="text-center">
                                        <input type="checkbox" name="transactions[]" value="{{ transaction.id }}" class="transaction-checkbox">
                                    </td>
                                    <td>{{ transaction.createdAt|date('d/m/Y H:i') }}</td>
                                    <td>{{ transaction.label }}</td>
                                    <td class="text-end fw-bold text-success">
                                        {{ transaction.value|number_format(2, ',', ' ') }} €
                                    </td>
                                </tr>
                            {% else %}
                                <tr>
                                    <td colspan="4" class="text-center py-4">Aucune transaction disponible pour une remise.</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="mt-4 d-flex justify-content-end">
            <a href="{{ path('app_remise') }}" class="btn btn-secondary me-2">Annuler</a>
            <button type="submit" class="btn btn-primary" {% if transactions is empty %}disabled{% endif %}>
                Créer la remise
            </button>
        </div>
    </form>
</div>

<script>
    function toggleAll(source) {
        checkboxes = document.getElementsByClassName('transaction-checkbox');
        for(var i=0, n=checkboxes.length;i<n;i++) {
            checkboxes[i].checked = source.checked;
        }
    }
</script>
{% endblock %}
